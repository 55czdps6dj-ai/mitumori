function updateUI() {
    // 1. 家財ポイント集計
    let pts = 0;
    Object.keys(counts).forEach(n => pts += counts[n] * (itemMaster[n] || 0));
    freeItems.forEach(i => pts += i.p * i.q);
    document.getElementById('total-points').textContent = pts;

    // 2. 係数と単価
    const pricePerPt = parseInt(document.getElementById('price-per-pt').value) || 0;
    const dayFactor = parseInt(document.getElementById('day-factor').value) / 100;
    const basePrice = 30000; // 基礎運賃（固定）

    // 3. 付帯サービス集計
    let optTotal = 0;
    document.querySelectorAll('.opt-check:checked').forEach(el => {
        optTotal += parseInt(el.closest('.opt-row').querySelector('.opt-price').value) || 0;
    });
    document.querySelectorAll('.custom-opt-check:checked').forEach(el => {
        optTotal += parseInt(el.closest('.opt-row').querySelector('.custom-opt-price').value) || 0;
    });

    // 4. 計算（現在条件）
    let currentMovingPrice = (basePrice + (pts * pricePerPt)) * dayFactor;
    let discountVal = parseInt(document.getElementById('special-discount').value) || 0;
    let discountRate = (100 - (parseInt(document.getElementById('discount-rate').value) || 0)) / 100;
    
    let final = Math.floor((currentMovingPrice + optTotal - discountVal) * discountRate);

    // 5. 比較用計算（平日基準：係数1.0, 割引なし）
    let stdFinal = (basePrice + (pts * pricePerPt)) + optTotal;

    // 6. 表示反映
    document.getElementById('row-base').textContent = "¥" + Math.floor(currentMovingPrice).toLocaleString();
    document.getElementById('row-base-std').textContent = "¥" + Math.floor(basePrice + (pts * pricePerPt)).toLocaleString();
    document.getElementById('row-opt').textContent = "¥" + optTotal.toLocaleString();
    document.getElementById('row-opt-std').textContent = "¥" + optTotal.toLocaleString();
    
    document.getElementById('final-price').textContent = "¥ " + final.toLocaleString();
    document.getElementById('std-price').textContent = "¥ " + stdFinal.toLocaleString();

    // 差額メッセージ
    let diff = stdFinal - final;
    const msgEl = document.getElementById('price-diff-msg');
    if (diff > 0) {
        msgEl.innerHTML = `<span style="color:green;">平日基準より <strong>¥${diff.toLocaleString()}</strong> お得です！</span>`;
    } else if (diff < 0) {
        msgEl.innerHTML = `<span style="color:red;">繁忙条件により <strong>¥${Math.abs(diff).toLocaleString()}</strong> 加算されています</span>`;
    } else {
        msgEl.textContent = "";
    }

    // 車両サジェスト
    let truck = pts <= 200 ? "2tショート" : (pts <= 300 ? "2tロング" : "3t車");
    document.getElementById('auto-truck').textContent = truck;
}
