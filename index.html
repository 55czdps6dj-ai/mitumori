<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>営業見積プロ v3.6</title>
    <style>
        :root { --blue: #00479d; --red: #e60012; --bg: #f4f7f9; --gray: #444; --green: #28a745; --orange: #f39c12; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding-bottom: 120px; color: #333; }
        .header { background: var(--blue); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; }
        .page { display: none; padding: 10px; }
        .page.active { display: block; }
        .pts-banner { background: var(--blue); color: white; padding: 12px; border-radius: 8px; text-align: center; font-weight: bold; margin-bottom: 10px; }
        
        /* カテゴリ（大枠） */
        .section-title { background: var(--gray); color: white; padding: 10px; margin-top: 10px; border-radius: 4px; font-size: 0.85rem; }
        
        /* アイテムグループ（ソファー等） */
        .item-group { background: white; border: 1px solid #ddd; margin-bottom: 5px; border-radius: 6px; overflow: hidden; }
        .group-header { padding: 12px 15px; font-weight: bold; background: #fff; cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
        .group-header::after { content: '▼'; font-size: 0.7rem; color: #888; }
        .group-header.open::after { content: '▲'; }
        .group-content { display: none; background: #fafafa; }
        .group-content.active { display: block; }

        /* 個別バリエーション */
        .variation-row { padding: 10px 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .var-info { display: flex; flex-direction: column; flex: 1; }
        .var-name { font-size: 0.85rem; font-weight: bold; }
        .var-size { font-size: 0.7rem; color: #666; font-family: monospace; }
        .var-pts { font-size: 0.75rem; color: var(--blue); font-weight: bold; }

        .ctrls { display: flex; align-items: center; gap: 5px; }
        .qty-input { width: 50px; height: 35px; text-align: center; border: 1px solid #ccc; border-radius: 4px; font-weight: bold; }
        .btn-qty { width: 34px; height: 34px; background: white; border: 1px solid #ccc; border-radius: 4px; font-weight: bold; }
        
        .nav-footer { position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #ddd; padding: 12px; display: flex; justify-content: space-between; box-sizing: border-box; z-index: 999; }
        .nav-btn { padding: 10px 20px; border-radius: 6px; border: none; font-weight: bold; }
        .btn-next { background: var(--blue); color: white; }
    </style>
</head>
<body>

<div class="header">
    <div style="width:30px"></div>
    <h1 id="page-title" style="font-size:1rem; margin:0;">家財選択</h1>
    <div style="width:30px"></div>
</div>

<div id="step1" class="page active">
    <div class="pts-banner">合計体積: <span id="grand-total-pts">0</span> P</div>
    <div id="list-container"></div>
</div>

<div id="step2" class="page">... (付帯工事画面) ...</div>
<div id="step3" class="page">... (配車画面) ...</div>
<div id="step4" class="page">... (比較画面) ...</div>

<div class="nav-footer">
    <button class="nav-btn" onclick="movePage(-1)">戻る</button>
    <span id="step-indicator">1 / 4</span>
    <button class="nav-btn btn-next" onclick="movePage(1)">次へ</button>
</div>

<script>
// 生データをグループ化して管理
const rawData = {
    "リビング": [
        {g: "ソファー", variations: [{n:"1人掛け", h:72, w:69, d:68.5, p:9}, {n:"2人掛け", h:78, w:140, d:78, p:22}, {n:"3人掛け", h:98, w:207, d:98, p:50}]},
        {g: "テレビ", variations: [{n:"液晶32型", h:39.8, w:70.8, d:15, p:2}, {n:"液晶37型", h:46.1, w:81.9, d:15, p:2}, {n:"液晶40型", h:49.8, w:88.5, d:15, p:2}, {n:"液晶43型", h:53.5, w:95.2, d:15, p:2}]},
        {g: "仏壇", variations: [{n:"小", h:41.5, w:33, d:28, p:1}, {n:"中", h:100, w:50, d:42, p:6}, {n:"大", h:130, w:80, d:45, p:12}]},
        {g: "エアコン", variations: [{n:"通常型", h:90, w:80, d:30, p:6}, {n:"ウィンドウ型", h:30, w:80, d:30, p:2}]}
    ],
    "キッチン": [
        {g: "冷蔵庫", variations: [{n:"2D", h:122.5, w:48, d:59.5, p:9}, {n:"3D", h:155.5, w:54, d:65.5, p:14}, {n:"4D", h:180, w:60, d:70, p:19}, {n:"5D", h:190, w:68.5, d:75, p:25}]},
        {g: "食器棚", variations: [{n:"小", h:85.7, w:119.6, d:50.5, p:13}, {n:"中", h:202, w:60, d:49, p:15}, {n:"大", h:175, w:88, d:42, p:17}, {n:"特大", h:202, w:160, d:51, p:42}]}
    ],
    "その他": [
        {g: "整理タンス", variations: [{n:"小", h:92, w:51, d:41, p:5}, {n:"中", h:90, w:80, d:40, p:8}, {n:"大", h:137, w:100, d:42, p:15}]},
        {g: "ベッド", variations: [{n:"通常", h:20, w:200, d:90, p:9}, {n:"引出し付", h:40, w:200, d:90, p:18}, {n:"二段式", h:30, w:200, d:90, p:14}, {n:"ソファーベッド", h:98, w:207, d:98, p:50}]}
    ]
};

let counts = {};

function init() {
    const container = document.getElementById('list-container');
    for (let cat in rawData) {
        const catTitle = document.createElement('div');
        catTitle.className = 'section-title';
        catTitle.innerText = cat;
        container.appendChild(catTitle);

        rawData[cat].forEach(group => {
            const gDiv = document.createElement('div');
            gDiv.className = 'item-group';
            
            const gHeader = document.createElement('div');
            gHeader.className = 'group-header';
            gHeader.innerHTML = `<span>${group.g}</span><span id="g-total-${group.g}" style="font-size:0.75rem; color:var(--blue);">0 P</span>`;
            
            const gContent = document.createElement('div');
            gContent.className = 'group-content';
            
            gHeader.onclick = () => {
                gHeader.classList.toggle('open');
                gContent.classList.toggle('active');
            };

            group.variations.forEach(v => {
                const id = group.g + v.n;
                const row = document.createElement('div');
                row.className = 'variation-row';
                row.innerHTML = `
                    <div class="var-info">
                        <span class="var-name">${v.n}</span>
                        <span class="var-size">H${v.h} W${v.w} D${v.d}</span>
                        <span class="var-pts">${v.p}P</span>
                    </div>
                    <div class="ctrls">
                        <button class="btn-qty" onclick="chg('${id}',-1,${v.p},'${group.g}')">－</button>
                        <input type="number" id="q-${id}" class="qty-input" value="0" readonly>
                        <button class="btn-qty" onclick="chg('${id}',1,${v.p},'${group.g}')">＋</button>
                    </div>`;
                gContent.appendChild(row);
            });
            
            gDiv.appendChild(gHeader);
            gDiv.appendChild(gContent);
            container.appendChild(gDiv);
        });
    }
}

function chg(id, d, p, groupName) {
    counts[id] = Math.max(0, (counts[id] || 0) + d);
    document.getElementById('q-' + id).value = counts[id];
    
    // グループ合計の更新
    let grandTotal = 0;
    for(let cat in rawData) {
        rawData[cat].forEach(g => {
            let groupSum = 0;
            g.variations.forEach(v => {
                groupSum += (counts[g.g + v.n] || 0) * v.p;
            });
            if(document.getElementById(`g-total-${g.g}`)) {
                document.getElementById(`g-total-${g.g}`).innerText = groupSum + " P";
            }
            grandTotal += groupSum;
        });
    }
    document.getElementById('grand-total-pts').innerText = grandTotal;
}

init();
</script>
</body>
</html>
